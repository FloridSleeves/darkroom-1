CD = cd $(BUILD_DIR); 

all: $(BUILD_DIR)/stage.bit

$(BUILD_DIR)/stage_map.ncd: $(BUILD_DIR)/pipeline.v
	$(CD) xst -ifn ../../xilinxify_xc7z020_axi/stage.xst > OUT_xst.txt
	$(CD) ngdbuild -nt timestamp -uc ../../xilinxify_xc7z020_axi/constraints.ucf -p xc7z020-clg484-1 stage.ngc stage.ngd > OUT_ngd.txt
	$(CD) map -p xc7z020-clg484-1 -w -logic_opt off -ol high -t 1 -xt 0 -register_duplication off -r 4 -mt off -ir off -pr off -lc off -power off -o stage_map.ncd stage.ngd stage.pcf > OUT_map.txt

$(BUILD_DIR)/stage.ncd: $(BUILD_DIR)/stage_map.ncd
	$(CD) par -w -ol high -mt off stage_map.ncd stage.ncd stage.pcf > OUT_par.txt

$(BUILD_DIR)/stage.bit: $(BUILD_DIR)/stage.ncd
	$(CD) trce -v 3 -s 1 -n 3 -fastpaths -xml stage.twx stage.ncd -o stage.twr stage.pcf -ucf ../../xilinxify_xc7z020_axi/constraints.ucf > OUT_trce.txt
	$(CD) bitgen -intstyle ise -f ../../xilinxify_xc7z020_axi/stage.ut stage.ncd > OUT_bitgen.txt

