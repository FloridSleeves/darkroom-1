---
layout: post
title: Try Darkroom
---
<link rel="stylesheet" href="stylesheets/codemirror.css">
<script src="javascripts/codemirror.js"></script>
<script src="javascripts/lua.js"></script>
<script src="javascripts/md5.js"></script>
<h1 id='installing_terra'>Try Darkroom</h1>
<div class="example" id="blurx.t" >
import "darkroom"
darkroomSimple = terralib.require("darkroomSimple")

a = darkroomSimple.load("color.bmp")
im a(x,y) [float[3]]( a(x,y) ) end

im blurx(x,y) 
  map i=-5,5 reduce(sum) a(x+i,y)/11 end
end

im blurx(x,y) [uint8[3]]( blurx ) end -- convert to 24 bit
blurx:save(arg[1]) -- write to arg[1] to display
</div>

<div class="example" id="bruteof.t">
import "darkroom"
darkroomSimple = terralib.require "darkroomSimple"

-- brute force optical flow

searchWindowRadius = 2
SADWindowRadius = 2

local frame1 = darkroomSimple.load("frame10.bmp")
frame1 = im(x,y) [int](frame1) end
local frame2 = darkroomSimple.load("frame11.bmp")
frame2 = im(x,y) [int](frame2) end

im bruteofVectorField(x,y)
  map i=-searchWindowRadius, searchWindowRadius j=-searchWindowRadius, searchWindowRadius reduce(argmin)
    -- sum of absolute differences (SAD)
    map ii=-SADWindowRadius, SADWindowRadius jj=-SADWindowRadius, SADWindowRadius reduce(sum)
      darkroom.abs(frame1(x+ii,y+jj)-frame2(x+i+ii,y+j+jj))
    end
  end
end

-- convert this to an RGB image so that the user can view it
im ofRGB(x,y) [uint8[3]]({(bruteofVectorField(x,y)[0])*50+128, (bruteofVectorField(x,y)[1])*50+128, 0}) end
ofRGB:save(arg[1])
</div>












<div style="float:right;">
<select id="examples" onchange="updatecontent()">
</select>
</div>
<br/>
<div id="editor">
</div>
<script>
var codemirror = CodeMirror(document.getElementById("editor"), {
  value: "",
  lineNumbers: true,
  lineWrapping: false,
  smartIndent: false,
  tabSize: 2,
  mode:  "lua"
});
function updatecontent() {
	var o = document.getElementById("examples")
	var name = o.options[o.selectedIndex].value
	var content = document.getElementById(name).textContent
	codemirror.setValue(content.replace(/^\n/,""))
	codemirror.setCursor(codemirror.lineCount(),0)
	codemirror.focus()
}
function finishresult(data) {
	var r = document.getElementById("result")
	var code = document.createElement("code")
	code.textContent = atob(data)
	var pre = document.createElement("pre")
	pre.appendChild(code)
	r.innerHTML = ""
	r.appendChild(pre)

//	var code = document.createElement("code")
//	code.textContent = md5(codemirror.getValue())
//  r.appendChild(code)

	var i = document.createElement("img")
  i.setAttribute('src', "http://candela.stanford.edu:4002/" + md5(codemirror.getValue()) + '.bmp');
	r.appendChild(i)
}
function execute() {
	var script = document.createElement("script")
	script.type = "text/javascript"
	var data = btoa(codemirror.getValue())
	script.src = "http://candela.stanford.edu:4002/" + data 
	document.getElementById("result").appendChild(script)
}
var selector = document.getElementById("examples")
var examples = document.getElementsByClassName("example")
for (var i = 0; i < examples.length; i++) {
	var o = document.createElement("option")
	o.textContent = examples[i].id
	selector.appendChild(o)
}
updatecontent()
</script>
<br>
<button type="button" style="float:right;" onclick="execute()">Execute</button>
<br>
<br>
<hr>
<div id="result"></div>
